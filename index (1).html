<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Aplikasi Canva Interaktif</title>
    <!-- Memuat Tailwind CSS untuk styling modern dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Mengatur font menjadi Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Latar belakang abu-abu sangat terang */
        }
        /* Custom Styling for a more 'Official' look */
        .official-button {
            /* Warna dominan biru gelap untuk kesan resmi */
            background-color: #1e3a8a; /* Blue 900 */
            color: #ffffff;
            font-weight: 700;
            /* Aksen warna kuning/emas untuk kontras dan elegan */
            border-bottom: 5px solid #fbbf24; /* Amber 400 */
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .official-button:hover {
            background-color: #172554; /* Blue 950 */
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        /* Style untuk teks pengembang di footer */
        .developer-text {
            color: #1e3a8a; /* Menggunakan warna biru gelap yang sama dengan tombol */
            font-weight: 600;
            padding-top: 4px;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Kontainer Utama Menu -->
    <div id="app-container" class="w-full max-w-lg bg-white shadow-2xl rounded-xl p-8 md:p-10 border-t-[10px] border-blue-800">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-blue-900 mb-2 border-b-2 border-amber-400 pb-2 inline-block">
                BAHAN TAYANG
            </h1>
            <h2 class="text-2xl font-bold text-gray-700 mt-2 mb-3">
                Menu Interaktif Canva " 7 JURUS BK HEBAT "
            </h2>
            <!-- TEKS DESKRIPSI -->
            <p class="text-sm text-gray-600 px-2 italic pt-3 mt-3">
                Aplikasi ini dirancang untuk memudahkan Bapak dan Ibu Guru dalam mengakses bahan tayang, dalam Mode Pembelajaran maupun Presentasi.
            </p>
            <!-- INFORMASI PENGEMBANG LAMA DIHAPUS DARI SINI -->
        </header>

        <!-- Daftar Tombol Menu -->
        <div id="menu-list" class="space-y-4">
            <!-- Data menu akan di-render di sini oleh JavaScript -->
        </div>

        <!-- Notifikasi pesan -->
        <div id="no-link-msg-container">
            <!-- Pesan akan dirender di sini -->
        </div>

        <!-- Footer Resmi -->
        <footer class="mt-10 pt-4 border-t border-gray-200 text-center">
            <!-- INFORMASI PENGEMBANG BARU DITAMBAHKAN DI SINI -->
            <p class="text-xs developer-text">
                Dikembangkan oleh ALFIAN - Guru Bimbingan Konseling ( Kab. Manokwari - Papua Barat )
            </p>
            <p class="text-xs text-gray-500 mt-1">
                Hak Cipta Â© 2025. Seluruh Konten Dilindungi.
            </p>
        </footer>

    </div>

    <script type="module">
        // Data awal untuk menu. Setiap item memiliki label dan link default.
        const initialMenuItems = [
            // Tautan Canva untuk JURUS 1
            { id: 'jurus1', label: 'JURUS 1 KENALI POTENSI', link: 'https://www.canva.com/design/DAGzhRcwUb8/Gl8P-cfNmoWA2TpjM9hLzw/edit?utm_content=DAGzhRcwUb8&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton' },
            // Tautan Canva untuk JURUS 2
            { id: 'jurus2', label: 'JURUS 2 KELOLA EMOSI', link: 'https://www.canva.com/design/DAGzhSxxIYU/YZc2Si_Ik5xnqQQo-zNW_g/edit?utm_content=DAGzhSxxIYU&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton' },
            // Tautan Canva untuk JURUS 3
            { id: 'jurus3', label: 'JURUS 3 TUMBUHKAN RESILIENSI', link: 'https://www.canva.com/design/DAG0_l7GEnk/nP6QjK8RVjHUWa7UPWDwhA/edit?utm_content=DAG0_l7GEnk&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton' },
            // Tautan Canva untuk JURUS 4 telah diperbarui
            { id: 'jurus4', label: 'JURUS 4 JAGA KONSISTENSI', link: 'https://www.canva.com/design/DAGzkjpb_mA/z3KvHeq3jlv8zNO0fxjA8Q/edit?utm_content=DAGzkjpb_mA&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton' },
            // Tautan Canva untuk JURUS 5 telah diperbarui
            { id: 'jurus5', label: 'JURUS 5 JALIN KONEKSI', link: 'https://www.canva.com/design/DAGzhJtYVkk/bPVeN8Xmy3LxgVIGNbw5HA/edit?utm_content=DAGzhJtYVkk&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton' },
            // Tautan Canva untuk JURUS 6 telah diperbarui di sini
            { id: 'jurus6', label: 'JURUS 6 BANGUN KOLABORASI', link: 'https://www.canva.com/design/DAGzkvkyuTw/afghiJdgdAad0TmaG1HujA/edit?utm_content=DAGzkvkyuTw&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton' },
            // Tautan Canva untuk JURUS 7 telah diperbarui di sini
            { id: 'jurus7', label: 'JURUS 7 MENATA SITUASI', link: 'https://www.canva.com/design/DAGzkq_Xafc/yKniNuO71uU94FZ78-Fabg/edit?utm_content=DAGzkq_Xafc&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton' }
        ];

        let menuData = [...initialMenuItems];
        
        // --- FIREBASE CONFIGURATION & AUTHENTICATION ---
        // Variabel global disediakan oleh lingkungan Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db;
        let auth;
        // Impor modul Firebase dari URL
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let userId = 'loading';
        let isAuthReady = false;

        // Fungsi inisialisasi Firebase dan otentikasi
        async function initializeFirebase() {
            try {
                if (!firebaseConfig) {
                    console.error("Firebase config tidak tersedia. Menggunakan data lokal.");
                    isAuthReady = true;
                    userId = 'local_user';
                    renderMenu();
                    return;
                }

                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Mengatur listener perubahan status otentikasi
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                    } else {
                        // Jika token kustom tidak ada, login secara anonim
                        if (!initialAuthToken) {
                            const anonymousUser = await signInAnonymously(auth);
                            userId = anonymousUser.user.uid;
                        }
                    }
                    isAuthReady = true;
                    // Lanjutkan dengan otentikasi kustom dan pemuatan data
                    if (initialAuthToken && user === null) {
                         try {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } catch (error) {
                            console.error("Gagal login dengan token kustom:", error);
                            // Fallback ke anonim jika token kustom gagal
                            await signInAnonymously(auth);
                            userId = auth.currentUser.uid;
                        }
                    }
                    
                    // Setelah otentikasi siap, muat data
                    loadMenuData();
                });

            } catch (error) {
                console.error("Gagal menginisialisasi Firebase:", error);
                // Fallback ke data lokal jika Firebase gagal dimuat
                isAuthReady = true;
                userId = 'local_user_fallback';
                renderMenu();
            }
        }

        // Jalur dokumen: /artifacts/{appId}/public/data/canva-menu/config
        function getConfigDocRef() {
            if (!db || !appId) return null;
            // Gunakan path publik agar semua pengguna melihat tautan yang sama
            return doc(db, 'artifacts', appId, 'public', 'data', 'canva-menu', 'config');
        }

        // Fungsi untuk menyimpan data menu ke Firestore (digunakan saat inisialisasi jika data belum ada)
        async function saveMenuData(dataToSave) {
            if (!isAuthReady || userId.startsWith('local_')) {
                console.error("Firebase belum siap atau menggunakan mode lokal. Penyimpanan dibatalkan.");
                return;
            }

            const configRef = getConfigDocRef();
            if (!configRef) return;

            try {
                // Simpan data, ini akan menimpa data yang ada atau membuat yang baru
                await setDoc(configRef, { menuItems: dataToSave, lastUpdatedBy: userId, timestamp: new Date() });
                console.log("Data menu berhasil disimpan ke Firestore.");
            } catch (error) {
                console.error("Gagal menyimpan data ke Firestore:", error);
            }
        }

        // Fungsi untuk memuat data menu dari Firestore
        function loadMenuData() {
            const configRef = getConfigDocRef();
            if (!configRef) {
                console.warn("Firestore belum siap. Menggunakan data default.");
                renderMenu();
                return;
            }

            // Gunakan onSnapshot untuk real-time updates
            onSnapshot(configRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data.menuItems && Array.isArray(data.menuItems)) {
                        menuData = data.menuItems;
                        console.log("Data menu dimuat dari Firestore.");
                    } else {
                        console.warn("Data Firestore tidak valid, menggunakan data default.");
                        // Jika data ada tetapi tidak valid, simpan data default (silent save)
                        saveMenuData(initialMenuItems);
                    }
                } else {
                    console.log("Dokumen menu tidak ditemukan. Menggunakan data default dan menyimpannya.");
                    // Jika dokumen tidak ada, simpan data default (silent save)
                    saveMenuData(initialMenuItems);
                }
                
                // Selalu render setelah data diperbarui
                renderMenu();
            }, (error) => {
                console.error("Gagal mendengarkan perubahan Firestore:", error);
                // Fallback ke data default jika terjadi kesalahan snapshot
                renderMenu();
            });
        }
        
        // --- RENDERING FUNGSI ---
        
        // Merender tombol menu
        function renderMenu() {
            const menuList = document.getElementById('menu-list');
            menuList.innerHTML = ''; // Kosongkan konten
            
            menuData.forEach(item => {
                const button = document.createElement('button');
                
                // Styling tombol baru: menggunakan class 'official-button' yang sudah didefinisikan di <style>
                button.className = 'w-full py-4 px-4 text-lg official-button rounded-lg shadow-xl focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50';
                
                button.textContent = item.label;
                button.onclick = () => handleButtonClick(item.link);
                
                menuList.appendChild(button);
            });
        }

        // Fungsi yang dipanggil saat tombol menu diklik
        function handleButtonClick(link) {
            // Periksa jika tautan kosong atau berisi placeholder generik
            if (!link || link.includes('/link-jurus-')) {
                // Tampilkan pesan jika tautan masih default atau tidak valid
                const container = document.getElementById('no-link-msg-container');
                let messageElement = document.getElementById('no-link-msg');
                
                // Hapus pesan lama jika ada
                if (messageElement) messageElement.remove();

                messageElement = document.createElement('div');
                messageElement.id = 'no-link-msg';
                messageElement.className = 'mt-4 p-3 bg-yellow-100 text-yellow-800 rounded-lg text-center font-medium shadow-inner border border-yellow-300';
                messageElement.textContent = 'Tautan untuk tombol ini belum diatur atau masih menggunakan tautan default. Harap hubungi administrator untuk pengaturan.';
                container.appendChild(messageElement);
                
                // Sembunyikan pesan setelah beberapa detik
                setTimeout(() => {
                    if (document.getElementById('no-link-msg')) document.getElementById('no-link-msg').remove();
                }, 4000);
                
                return;
            }

            // Buka tautan di tab baru
            window.open(link, '_blank');
        }

        // Inisialisasi Firebase dan pemuatan data saat halaman dimuat
        window.onload = initializeFirebase;
        
    </script>
</body>
</html>
